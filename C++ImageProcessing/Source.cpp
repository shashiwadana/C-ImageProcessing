
#include <opencv2/core/core.hpp>

#include <opencv2/highgui/highgui.hpp>

#include <opencv2/imgproc/imgproc.hpp>

#include <iostream>



using namespace cv;

using namespace std;

int main(int argc, char** argv)

{

	if (argc != 2)

	{

		cout << " Usage: display_image ImageToLoadAndDisplay" << endl;

		return -1;

	}

	Mat image;

	image = imread(argv[1], IMREAD_COLOR); // Read the file



	if (!image.data) // Check for invalid input

	{

		cout << "Could not open or find the image" << std::endl;

		return -1;

	}

	Mat gr;



	cvtColor(image, gr, cv::COLOR_BGR2GRAY, 0);



	int h = gr.rows;

	int w = gr.cols;

	int x = 0;

	double y = 0.0;

	cout << "Width: " << w << endl;

	cout << "Height: " << h << endl;



	Mat CSt = gr.clone();



	for (int i = 0; i < h; i++) {

		for (int j = 0; j < w; j++) {

			x = (int)gr.at<uchar>(i, j);

			y = 0.0;

			if (x < 155) {

				y = (double)(5 / 155) * (double)(x);

			}

			else {

				if (x < 212) {

					y = (double)(245 / 57) * (double)(x - 155) + 5;

				}

				else {

					y = (double)(5 / 43) * (double)(x - 212) + 250;

				}



			}

			CSt.at<uchar>(i, j) = (uchar)(cvRound(y));

		}

	}

	namedWindow("Display window", WINDOW_AUTOSIZE); // Create a window for display.

	imshow("Display window", CSt); // Show our image inside it.

	namedWindow("Display Gray", WINDOW_AUTOSIZE); // Create a window for display.

	imshow("Display Gray", gr); // Show our image inside it.

	waitKey(0); // Wait for a keystroke in the window

	image.release();

	gr.release();

	return 0;

}